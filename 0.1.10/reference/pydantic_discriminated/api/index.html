
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Type-safe discriminated unions for Pydantic models">
      
      
      
        <link rel="canonical" href="https://talbotknighton.github.io/pydantic-discriminated/latest/reference/pydantic_discriminated/api/">
      
      
        <link rel="prev" href="../">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>api - pydantic-discriminated</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pydantic_discriminated.api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="pydantic-discriminated" class="md-header__button md-logo" aria-label="pydantic-discriminated" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pydantic-discriminated
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              api
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/TalbotKnighton/pydantic-discriminated" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    TalbotKnighton/pydantic-discriminated
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="pydantic-discriminated" class="md-nav__button md-logo" aria-label="pydantic-discriminated" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pydantic-discriminated
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/TalbotKnighton/pydantic-discriminated" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    TalbotKnighton/pydantic-discriminated
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../technical_documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technical Details
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Code Reference
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Code Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pydantic_discriminated.api" class="md-nav__link">
    <span class="md-ellipsis">
      api
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedBaseModel" class="md-nav__link">
    <span class="md-ellipsis">
      DiscriminatedBaseModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiscriminatedBaseModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedBaseModel.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __getattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedBaseModel.model_dump" class="md-nav__link">
    <span class="md-ellipsis">
      model_dump
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedBaseModel.model_validate" class="md-nav__link">
    <span class="md-ellipsis">
      model_validate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedBaseModel.model_validate_json" class="md-nav__link">
    <span class="md-ellipsis">
      model_validate_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedBaseModel.serialize_model" class="md-nav__link">
    <span class="md-ellipsis">
      serialize_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedBaseModel.validate_discriminated" class="md-nav__link">
    <span class="md-ellipsis">
      validate_discriminated
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedConfig" class="md-nav__link">
    <span class="md-ellipsis">
      DiscriminatedConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiscriminatedConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedConfig.disable_monkey_patching" class="md-nav__link">
    <span class="md-ellipsis">
      disable_monkey_patching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedConfig.enable_monkey_patching" class="md-nav__link">
    <span class="md-ellipsis">
      enable_monkey_patching
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedModelRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      DiscriminatedModelRegistry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiscriminatedModelRegistry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedModelRegistry.get_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedModelRegistry.get_models_for_category" class="md-nav__link">
    <span class="md-ellipsis">
      get_models_for_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatedModelRegistry.register" class="md-nav__link">
    <span class="md-ellipsis">
      register
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatorAwareBaseModel" class="md-nav__link">
    <span class="md-ellipsis">
      DiscriminatorAwareBaseModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiscriminatorAwareBaseModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatorAwareBaseModel.model_dump" class="md-nav__link">
    <span class="md-ellipsis">
      model_dump
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.DiscriminatorAwareBaseModel.model_dump_json" class="md-nav__link">
    <span class="md-ellipsis">
      model_dump_json
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydantic_discriminated.api.discriminated_model" class="md-nav__link">
    <span class="md-ellipsis">
      discriminated_model
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>api</h1>

<div class="doc doc-object doc-module">



<a id="pydantic_discriminated.api"></a>
    <div class="doc doc-contents first">

        <p>Pydantic Discriminated Union Support</p>
<p>This module provides functionality for working with discriminated unions in Pydantic models.
Discriminated unions allow handling polymorphic data structures in a type-safe way by using
a "discriminator" field to indicate the concrete type.</p>
<p>The module supports:
- Decorating models with discriminator information
- Automatic serialization with discriminator fields
- Registry for looking up model types by discriminator values
- Optional monkey patching of Pydantic's BaseModel for seamless integration</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="pydantic_discriminated.api.DiscriminatedBaseModel" class="doc doc-heading">
            <code>DiscriminatedBaseModel</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Base class for discriminated models that ensures discriminator fields are included
in serialization only when requested.</p>
<p>This class must be used as the base class for all models that will be part of
a discriminated union. It provides methods for validating and serializing
discriminated models.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pydantic_discriminated.api.DiscriminatedBaseModel._discriminator_field">_discriminator_field</span></code></td>
            <td>
                  <code><span title="typing.ClassVar">ClassVar</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discriminator field name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pydantic_discriminated.api.DiscriminatedBaseModel._discriminator_value">_discriminator_value</span></code></td>
            <td>
                  <code><span title="typing.ClassVar">ClassVar</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discriminator value for this model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pydantic_discriminated.api.DiscriminatedBaseModel._use_standard_fields">_use_standard_fields</span></code></td>
            <td>
                  <code><span title="typing.ClassVar">ClassVar</span>[<span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use standard discriminator fields.
Defaults to the global setting in DiscriminatedConfig.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nd">@discriminated_model</span><span class="p">(</span><span class="s2">&quot;shape_type&quot;</span><span class="p">,</span> <span class="s2">&quot;circle&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">class</span><span class="w"> </span><span class="nc">Circle</span><span class="p">(</span><span class="n">DiscriminatedBaseModel</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">circle</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>  <span class="c1"># Includes discriminator fields</span>
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DiscriminatedBaseModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for discriminated models that ensures discriminator fields are included</span>
<span class="sd">    in serialization only when requested.</span>

<span class="sd">    This class must be used as the base class for all models that will be part of</span>
<span class="sd">    a discriminated union. It provides methods for validating and serializing</span>
<span class="sd">    discriminated models.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        _discriminator_field (ClassVar[str]): The discriminator field name.</span>
<span class="sd">        _discriminator_value (ClassVar[Any]): The discriminator value for this model.</span>
<span class="sd">        _use_standard_fields (ClassVar[bool]): Whether to use standard discriminator fields.</span>
<span class="sd">            Defaults to the global setting in DiscriminatedConfig.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; @discriminated_model(&quot;shape_type&quot;, &quot;circle&quot;)</span>
<span class="sd">        ... class Circle(DiscriminatedBaseModel):</span>
<span class="sd">        ...     radius: float</span>
<span class="sd">        &gt;&gt;&gt; circle = Circle(radius=5)</span>
<span class="sd">        &gt;&gt;&gt; data = circle.model_dump()  # Includes discriminator fields</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Legacy fields for compatibility</span>
    <span class="n">_discriminator_field</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">_discriminator_value</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_use_standard_fields</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">use_standard_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom attribute access to handle discriminator field.</span>

<span class="sd">        This method allows accessing the discriminator value through the discriminator</span>
<span class="sd">        field name, as well as through the standard discriminator fields.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The attribute name being accessed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Any): The discriminator value if name is the discriminator field or a standard</span>
<span class="sd">            discriminator field, otherwise raises AttributeError.</span>

<span class="sd">        Raises:</span>
<span class="sd">            (AttributeError): If the attribute doesn&#39;t exist and isn&#39;t a discriminator field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle access to the legacy discriminator field</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_value</span>

        <span class="c1"># Handle access to standard discriminator fields</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_value</span>

        <span class="c1"># Default behavior for other attributes</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">model_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override model_dump to control when discriminators are included.</span>

<span class="sd">        This method allows controlling whether discriminator fields are included</span>
<span class="sd">        in the serialized output using the use_discriminators parameter or the</span>
<span class="sd">        global setting.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the parent model_dump method.</span>
<span class="sd">                A special &#39;use_discriminators&#39; parameter can be passed to override</span>
<span class="sd">                the global setting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): The serialized model with discriminator fields included or excluded</span>
<span class="sd">                based on configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract our custom parameter or use the global setting</span>
        <span class="n">use_discriminators</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;use_discriminators&quot;</span><span class="p">,</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">patch_base_model</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG DiscriminatedBaseModel.model_dump: use_discriminators=</span><span class="si">{</span><span class="n">use_discriminators</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Get the result from the original method (without our custom parameter)</span>
        <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">_patched</span><span class="p">:</span>
            <span class="c1"># If patched, use the original method via the global store</span>
            <span class="c1"># Make a copy of kwargs to avoid modifying the original</span>
            <span class="n">kwargs_copy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;use_discriminators&quot;</span> <span class="ow">in</span> <span class="n">kwargs_copy</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs_copy</span><span class="p">[</span><span class="s2">&quot;use_discriminators&quot;</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_original_methods</span><span class="p">[</span><span class="s2">&quot;model_dump&quot;</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_copy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If not patched, use the superclass method</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Remove discriminator fields if they shouldn&#39;t be included</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_discriminators</span><span class="p">:</span>
            <span class="c1"># Remove domain-specific discriminator field</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">)</span>

            <span class="c1"># Remove standard fields if present</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_standard_fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@model_serializer</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">serialize_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom serializer that includes discriminator fields only when requested.</span>

<span class="sd">        This method is used by Pydantic&#39;s serialization system to convert the model</span>
<span class="sd">        to a dictionary. It includes the discriminator fields, which can later be</span>
<span class="sd">        filtered out by model_dump if needed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): Dictionary representation of the model, including discriminator fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get all field values without special handling</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)}</span>

        <span class="c1"># Add discriminator fields if configured to do so in global settings</span>
        <span class="c1"># These will be filtered in model_dump if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_value</span>

        <span class="c1"># Add standard fields if configured</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_standard_fields</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span>
            <span class="n">data</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_value</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">model_validate</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the given object and return an instance of this model.</span>

<span class="sd">        Enhanced to handle discriminator validation. This method checks if the</span>
<span class="sd">        discriminator value in the input data matches the expected value for this</span>
<span class="sd">        model class.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj: The object to validate.</span>
<span class="sd">            **kwargs: Additional arguments to pass to the original model_validate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An instance of this model.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the discriminator value in the input data doesn&#39;t match</span>
<span class="sd">                the expected value for this model class.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; data = {&quot;shape_type&quot;: &quot;circle&quot;, &quot;radius&quot;: 5}</span>
<span class="sd">            &gt;&gt;&gt; circle = Circle.model_validate(data)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">use_standard_fields</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;_use_standard_fields&quot;</span><span class="p">,</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">use_standard_fields</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Create a copy to avoid modifying the original</span>

            <span class="c1"># Check if we have standard discriminator fields</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">use_standard_fields</span>
                <span class="ow">and</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span> <span class="ow">in</span> <span class="n">new_obj</span>
                <span class="ow">and</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span> <span class="ow">in</span> <span class="n">new_obj</span>
            <span class="p">):</span>

                <span class="c1"># Use standard fields for validation</span>
                <span class="k">if</span> <span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Invalid discriminator category: expected </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="si">}</span><span class="s2">, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Invalid discriminator value: expected </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="si">}</span><span class="s2">, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

            <span class="c1"># Check legacy field if present</span>
            <span class="k">elif</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">in</span> <span class="n">new_obj</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">new_obj</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Invalid discriminator value: expected </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="si">}</span><span class="s2">, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">new_obj</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

            <span class="c1"># Add domain-specific discriminator field if missing</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_obj</span><span class="p">:</span>
                <span class="n">new_obj</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span>

            <span class="c1"># Add standard discriminator fields if configured and missing</span>
            <span class="k">if</span> <span class="n">use_standard_fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_obj</span><span class="p">:</span>
                    <span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span>
                <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_obj</span><span class="p">:</span>
                    <span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span>

            <span class="n">obj</span> <span class="o">=</span> <span class="n">new_obj</span>

        <span class="c1"># Call the original model_validate</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Set the discriminator values on the instance</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;_discriminator_field&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;_discriminator_value&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;_use_standard_fields&quot;</span><span class="p">,</span> <span class="n">use_standard_fields</span><span class="p">)</span>

        <span class="c1"># For backward compatibility, also set the domain-specific field</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">:</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="p">)</span>

        <span class="c1"># Set standard fields if configured</span>
        <span class="k">if</span> <span class="n">use_standard_fields</span><span class="p">:</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span>
                <span class="n">instance</span><span class="p">,</span>
                <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span>
                <span class="n">instance</span><span class="p">,</span>
                <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">instance</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">model_validate_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">json_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the given JSON data and return an instance of this model.</span>

<span class="sd">        Enhanced to handle discriminator validation. This method parses the JSON data</span>
<span class="sd">        and then uses model_validate to validate it.</span>

<span class="sd">        Args:</span>
<span class="sd">            json_data: The JSON data to validate.</span>
<span class="sd">            **kwargs: Additional arguments to pass to model_validate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An instance of this model.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; json_str = &#39;{&quot;shape_type&quot;: &quot;circle&quot;, &quot;radius&quot;: 5}&#39;</span>
<span class="sd">            &gt;&gt;&gt; circle = Circle.model_validate_json(json_str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Parse JSON first</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="n">json_data</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>

        <span class="c1"># Now validate with our enhanced model_validate</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_discriminated</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;DiscriminatedBaseModel&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate and return the appropriate discriminated model based on the discriminator value.</span>

<span class="sd">        This method looks at the discriminator fields in the data and dispatches</span>
<span class="sd">        to the appropriate model class based on the discriminator value.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The data to validate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An instance of the appropriate discriminated model.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no discriminator fields are found in the data.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; data = {&quot;shape_type&quot;: &quot;circle&quot;, &quot;radius&quot;: 5}</span>
<span class="sd">            &gt;&gt;&gt; shape = DiscriminatedBaseModel.validate_discriminated(data)</span>
<span class="sd">            &gt;&gt;&gt; isinstance(shape, Circle)</span>
<span class="sd">            True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">use_standard_fields</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;_use_standard_fields&quot;</span><span class="p">,</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">use_standard_fields</span>
        <span class="p">)</span>

        <span class="c1"># First check standard discriminator fields if configured</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">use_standard_fields</span>
            <span class="ow">and</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span> <span class="ow">in</span> <span class="n">data</span>
            <span class="ow">and</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span> <span class="ow">in</span> <span class="n">data</span>
        <span class="p">):</span>

            <span class="n">category</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span>

        <span class="c1"># Fall back to domain-specific field</span>
        <span class="k">elif</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">category</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No discriminator fields found in data&quot;</span><span class="p">)</span>

        <span class="c1"># Get the appropriate model class</span>
        <span class="n">model_cls</span> <span class="o">=</span> <span class="n">DiscriminatedModelRegistry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># Validate with the model class</span>
        <span class="k">return</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatedBaseModel.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Custom attribute access to handle discriminator field.</p>
<p>This method allows accessing the discriminator value through the discriminator
field name, as well as through the standard discriminator fields.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The attribute name being accessed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discriminator value if name is the discriminator field or a standard</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>discriminator field, otherwise raises AttributeError.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the attribute doesn't exist and isn't a discriminator field.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom attribute access to handle discriminator field.</span>

<span class="sd">    This method allows accessing the discriminator value through the discriminator</span>
<span class="sd">    field name, as well as through the standard discriminator fields.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The attribute name being accessed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (Any): The discriminator value if name is the discriminator field or a standard</span>
<span class="sd">        discriminator field, otherwise raises AttributeError.</span>

<span class="sd">    Raises:</span>
<span class="sd">        (AttributeError): If the attribute doesn&#39;t exist and isn&#39;t a discriminator field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Handle access to the legacy discriminator field</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_value</span>

    <span class="c1"># Handle access to standard discriminator fields</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_value</span>

    <span class="c1"># Default behavior for other attributes</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatedBaseModel.model_dump" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Override model_dump to control when discriminators are included.</p>
<p>This method allows controlling whether discriminator fields are included
in the serialized output using the use_discriminators parameter or the
global setting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments to pass to the parent model_dump method.
A special 'use_discriminators' parameter can be passed to override
the global setting.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The serialized model with discriminator fields included or excluded
based on configuration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">model_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Override model_dump to control when discriminators are included.</span>

<span class="sd">    This method allows controlling whether discriminator fields are included</span>
<span class="sd">    in the serialized output using the use_discriminators parameter or the</span>
<span class="sd">    global setting.</span>

<span class="sd">    Args:</span>
<span class="sd">        **kwargs: Keyword arguments to pass to the parent model_dump method.</span>
<span class="sd">            A special &#39;use_discriminators&#39; parameter can be passed to override</span>
<span class="sd">            the global setting.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): The serialized model with discriminator fields included or excluded</span>
<span class="sd">            based on configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract our custom parameter or use the global setting</span>
    <span class="n">use_discriminators</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;use_discriminators&quot;</span><span class="p">,</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">patch_base_model</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG DiscriminatedBaseModel.model_dump: use_discriminators=</span><span class="si">{</span><span class="n">use_discriminators</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get the result from the original method (without our custom parameter)</span>
    <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">_patched</span><span class="p">:</span>
        <span class="c1"># If patched, use the original method via the global store</span>
        <span class="c1"># Make a copy of kwargs to avoid modifying the original</span>
        <span class="n">kwargs_copy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;use_discriminators&quot;</span> <span class="ow">in</span> <span class="n">kwargs_copy</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kwargs_copy</span><span class="p">[</span><span class="s2">&quot;use_discriminators&quot;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_original_methods</span><span class="p">[</span><span class="s2">&quot;model_dump&quot;</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_copy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If not patched, use the superclass method</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Remove discriminator fields if they shouldn&#39;t be included</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_discriminators</span><span class="p">:</span>
        <span class="c1"># Remove domain-specific discriminator field</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">)</span>

        <span class="c1"># Remove standard fields if present</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_standard_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatedBaseModel.model_validate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Validate the given object and return an instance of this model.</p>
<p>Enhanced to handle discriminator validation. This method checks if the
discriminator value in the input data matches the expected value for this
model class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The object to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments to pass to the original model_validate.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pydantic_discriminated.api.T">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of this model.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the discriminator value in the input data doesn't match
the expected value for this model class.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shape_type&quot;</span><span class="p">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">model_validate</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the given object and return an instance of this model.</span>

<span class="sd">    Enhanced to handle discriminator validation. This method checks if the</span>
<span class="sd">    discriminator value in the input data matches the expected value for this</span>
<span class="sd">    model class.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj: The object to validate.</span>
<span class="sd">        **kwargs: Additional arguments to pass to the original model_validate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An instance of this model.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the discriminator value in the input data doesn&#39;t match</span>
<span class="sd">            the expected value for this model class.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; data = {&quot;shape_type&quot;: &quot;circle&quot;, &quot;radius&quot;: 5}</span>
<span class="sd">        &gt;&gt;&gt; circle = Circle.model_validate(data)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">use_standard_fields</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;_use_standard_fields&quot;</span><span class="p">,</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">use_standard_fields</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">new_obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Create a copy to avoid modifying the original</span>

        <span class="c1"># Check if we have standard discriminator fields</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">use_standard_fields</span>
            <span class="ow">and</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span> <span class="ow">in</span> <span class="n">new_obj</span>
            <span class="ow">and</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span> <span class="ow">in</span> <span class="n">new_obj</span>
        <span class="p">):</span>

            <span class="c1"># Use standard fields for validation</span>
            <span class="k">if</span> <span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid discriminator category: expected </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid discriminator value: expected </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Check legacy field if present</span>
        <span class="k">elif</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">in</span> <span class="n">new_obj</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">new_obj</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid discriminator value: expected </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">new_obj</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Add domain-specific discriminator field if missing</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_obj</span><span class="p">:</span>
            <span class="n">new_obj</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span>

        <span class="c1"># Add standard discriminator fields if configured and missing</span>
        <span class="k">if</span> <span class="n">use_standard_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_obj</span><span class="p">:</span>
                <span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span>
            <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_obj</span><span class="p">:</span>
                <span class="n">new_obj</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">new_obj</span>

    <span class="c1"># Call the original model_validate</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Set the discriminator values on the instance</span>
    <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;_discriminator_field&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">)</span>
    <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;_discriminator_value&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="p">)</span>
    <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;_use_standard_fields&quot;</span><span class="p">,</span> <span class="n">use_standard_fields</span><span class="p">)</span>

    <span class="c1"># For backward compatibility, also set the domain-specific field</span>
    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">:</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="p">)</span>

    <span class="c1"># Set standard fields if configured</span>
    <span class="k">if</span> <span class="n">use_standard_fields</span><span class="p">:</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span>
            <span class="n">instance</span><span class="p">,</span>
            <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span>
            <span class="n">instance</span><span class="p">,</span>
            <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">instance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatedBaseModel.model_validate_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model_validate_json</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Validate the given JSON data and return an instance of this model.</p>
<p>Enhanced to handle discriminator validation. This method parses the JSON data
and then uses model_validate to validate it.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>json_data</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="bytes">bytes</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The JSON data to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments to pass to model_validate.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pydantic_discriminated.api.T">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of this model.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">json_str</span> <span class="o">=</span> <span class="s1">&#39;{&quot;shape_type&quot;: &quot;circle&quot;, &quot;radius&quot;: 5}&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="o">.</span><span class="n">model_validate_json</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">model_validate_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">json_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the given JSON data and return an instance of this model.</span>

<span class="sd">    Enhanced to handle discriminator validation. This method parses the JSON data</span>
<span class="sd">    and then uses model_validate to validate it.</span>

<span class="sd">    Args:</span>
<span class="sd">        json_data: The JSON data to validate.</span>
<span class="sd">        **kwargs: Additional arguments to pass to model_validate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An instance of this model.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; json_str = &#39;{&quot;shape_type&quot;: &quot;circle&quot;, &quot;radius&quot;: 5}&#39;</span>
<span class="sd">        &gt;&gt;&gt; circle = Circle.model_validate_json(json_str)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Parse JSON first</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">json_data</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>

    <span class="c1"># Now validate with our enhanced model_validate</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatedBaseModel.serialize_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialize_model</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Custom serializer that includes discriminator fields only when requested.</p>
<p>This method is used by Pydantic's serialization system to convert the model
to a dictionary. It includes the discriminator fields, which can later be
filtered out by model_dump if needed.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary representation of the model, including discriminator fields.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@model_serializer</span>
<span class="k">def</span><span class="w"> </span><span class="nf">serialize_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom serializer that includes discriminator fields only when requested.</span>

<span class="sd">    This method is used by Pydantic&#39;s serialization system to convert the model</span>
<span class="sd">    to a dictionary. It includes the discriminator fields, which can later be</span>
<span class="sd">    filtered out by model_dump if needed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): Dictionary representation of the model, including discriminator fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get all field values without special handling</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)}</span>

    <span class="c1"># Add discriminator fields if configured to do so in global settings</span>
    <span class="c1"># These will be filtered in model_dump if needed</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_value</span>

    <span class="c1"># Add standard fields if configured</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_standard_fields</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_field</span>
        <span class="n">data</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discriminator_value</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatedBaseModel.validate_discriminated" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_discriminated</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Validate and return the appropriate discriminated model based on the discriminator value.</p>
<p>This method looks at the discriminator fields in the data and dispatches
to the appropriate model class based on the discriminator value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DiscriminatedBaseModel (pydantic_discriminated.api.DiscriminatedBaseModel)" href="#pydantic_discriminated.api.DiscriminatedBaseModel">DiscriminatedBaseModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the appropriate discriminated model.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no discriminator fields are found in the data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shape_type&quot;</span><span class="p">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">DiscriminatedBaseModel</span><span class="o">.</span><span class="n">validate_discriminated</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">Circle</span><span class="p">)</span>
<span class="go">True</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_discriminated</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;DiscriminatedBaseModel&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate and return the appropriate discriminated model based on the discriminator value.</span>

<span class="sd">    This method looks at the discriminator fields in the data and dispatches</span>
<span class="sd">    to the appropriate model class based on the discriminator value.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: The data to validate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An instance of the appropriate discriminated model.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no discriminator fields are found in the data.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; data = {&quot;shape_type&quot;: &quot;circle&quot;, &quot;radius&quot;: 5}</span>
<span class="sd">        &gt;&gt;&gt; shape = DiscriminatedBaseModel.validate_discriminated(data)</span>
<span class="sd">        &gt;&gt;&gt; isinstance(shape, Circle)</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">use_standard_fields</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;_use_standard_fields&quot;</span><span class="p">,</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">use_standard_fields</span>
    <span class="p">)</span>

    <span class="c1"># First check standard discriminator fields if configured</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">use_standard_fields</span>
        <span class="ow">and</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span> <span class="ow">in</span> <span class="n">data</span>
        <span class="ow">and</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span> <span class="ow">in</span> <span class="n">data</span>
    <span class="p">):</span>

        <span class="n">category</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span>

    <span class="c1"># Fall back to domain-specific field</span>
    <span class="k">elif</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No discriminator fields found in data&quot;</span><span class="p">)</span>

    <span class="c1"># Get the appropriate model class</span>
    <span class="n">model_cls</span> <span class="o">=</span> <span class="n">DiscriminatedModelRegistry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="c1"># Validate with the model class</span>
    <span class="k">return</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pydantic_discriminated.api.DiscriminatedConfig" class="doc doc-heading">
            <code>DiscriminatedConfig</code>


</h2>


    <div class="doc doc-contents ">


        <p>Global configuration for discriminated models.</p>
<p>This class contains settings that control how discriminated models behave,
including whether to use standard fields, field naming, and monkey patching behavior.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pydantic_discriminated.api.DiscriminatedConfig.use_standard_fields">use_standard_fields</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include standard discriminator fields
in addition to domain-specific ones. Default is True.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pydantic_discriminated.api.DiscriminatedConfig.standard_category_field">standard_category_field</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The field name for the standard category field.
Default is "discriminator_category".</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pydantic_discriminated.api.DiscriminatedConfig.standard_value_field">standard_value_field</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The field name for the standard value field.
Default is "discriminator_value".</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pydantic_discriminated.api.DiscriminatedConfig.patch_base_model">patch_base_model</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to control whether to patch BaseModel.
Default is True.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pydantic_discriminated.api.DiscriminatedConfig._patched">_patched</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal flag to track if patching has been applied.
Default is False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DiscriminatedConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Global configuration for discriminated models.</span>

<span class="sd">    This class contains settings that control how discriminated models behave,</span>
<span class="sd">    including whether to use standard fields, field naming, and monkey patching behavior.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        use_standard_fields (bool): Whether to include standard discriminator fields</span>
<span class="sd">            in addition to domain-specific ones. Default is True.</span>
<span class="sd">        standard_category_field (str): The field name for the standard category field.</span>
<span class="sd">            Default is &quot;discriminator_category&quot;.</span>
<span class="sd">        standard_value_field (str): The field name for the standard value field.</span>
<span class="sd">            Default is &quot;discriminator_value&quot;.</span>
<span class="sd">        patch_base_model (bool): Flag to control whether to patch BaseModel.</span>
<span class="sd">            Default is True.</span>
<span class="sd">        _patched (bool): Internal flag to track if patching has been applied.</span>
<span class="sd">            Default is False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">use_standard_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">standard_category_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;discriminator_category&quot;</span>
    <span class="n">standard_value_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;discriminator_value&quot;</span>

    <span class="c1"># Flag to control whether to patch BaseModel</span>
    <span class="n">patch_base_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Flag to track if patching has already been applied</span>
    <span class="n">_patched</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">enable_monkey_patching</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable monkey patching of BaseModel for discriminator support in all models.</span>

<span class="sd">        This method enables the automatic inclusion of discriminator fields in</span>
<span class="sd">        serialized output from any Pydantic model. It applies the patch if not</span>
<span class="sd">        already applied.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from pydantic_discriminated import DiscriminatedConfig</span>
<span class="sd">            &gt;&gt;&gt; DiscriminatedConfig.enable_monkey_patching()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">patch_base_model</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Apply the patch if not already applied</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_patched</span><span class="p">:</span>
            <span class="n">_apply_monkey_patch</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">disable_monkey_patching</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable monkey patching of BaseModel.</span>

<span class="sd">        When disabled, users must use DiscriminatorAwareBaseModel for containers</span>
<span class="sd">        that need to preserve discriminator information in serialized output.</span>
<span class="sd">        The flag is changed but the patch remains applied to avoid runtime changes</span>
<span class="sd">        to method references.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from pydantic_discriminated import DiscriminatedConfig</span>
<span class="sd">            &gt;&gt;&gt; DiscriminatedConfig.disable_monkey_patching()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEBUG: Disabling monkey patching, previous value:&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">patch_base_model</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">patch_base_model</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEBUG: After disabling, new value:&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">patch_base_model</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatedConfig.disable_monkey_patching" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">disable_monkey_patching</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Disable monkey patching of BaseModel.</p>
<p>When disabled, users must use DiscriminatorAwareBaseModel for containers
that need to preserve discriminator information in serialized output.
The flag is changed but the patch remains applied to avoid runtime changes
to method references.</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_discriminated</span><span class="w"> </span><span class="kn">import</span> <span class="n">DiscriminatedConfig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">disable_monkey_patching</span><span class="p">()</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">disable_monkey_patching</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Disable monkey patching of BaseModel.</span>

<span class="sd">    When disabled, users must use DiscriminatorAwareBaseModel for containers</span>
<span class="sd">    that need to preserve discriminator information in serialized output.</span>
<span class="sd">    The flag is changed but the patch remains applied to avoid runtime changes</span>
<span class="sd">    to method references.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from pydantic_discriminated import DiscriminatedConfig</span>
<span class="sd">        &gt;&gt;&gt; DiscriminatedConfig.disable_monkey_patching()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEBUG: Disabling monkey patching, previous value:&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">patch_base_model</span><span class="p">)</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">patch_base_model</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEBUG: After disabling, new value:&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">patch_base_model</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatedConfig.enable_monkey_patching" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">enable_monkey_patching</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Enable monkey patching of BaseModel for discriminator support in all models.</p>
<p>This method enables the automatic inclusion of discriminator fields in
serialized output from any Pydantic model. It applies the patch if not
already applied.</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_discriminated</span><span class="w"> </span><span class="kn">import</span> <span class="n">DiscriminatedConfig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">enable_monkey_patching</span><span class="p">()</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">enable_monkey_patching</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enable monkey patching of BaseModel for discriminator support in all models.</span>

<span class="sd">    This method enables the automatic inclusion of discriminator fields in</span>
<span class="sd">    serialized output from any Pydantic model. It applies the patch if not</span>
<span class="sd">    already applied.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from pydantic_discriminated import DiscriminatedConfig</span>
<span class="sd">        &gt;&gt;&gt; DiscriminatedConfig.enable_monkey_patching()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">patch_base_model</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># Apply the patch if not already applied</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_patched</span><span class="p">:</span>
        <span class="n">_apply_monkey_patch</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pydantic_discriminated.api.DiscriminatedModelRegistry" class="doc doc-heading">
            <code>DiscriminatedModelRegistry</code>


</h2>


    <div class="doc doc-contents ">


        <p>Registry to store and retrieve discriminated models.</p>
<p>This class maintains a registry of discriminated models indexed by their
category and discriminator value, allowing lookup of the appropriate model class
at validation time.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pydantic_discriminated.api.DiscriminatedModelRegistry._registry">_registry</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Dict">Dict</span>[<span title="typing.Any">Any</span>, <span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="DiscriminatedBaseModel (pydantic_discriminated.api.DiscriminatedBaseModel)" href="#pydantic_discriminated.api.DiscriminatedBaseModel">DiscriminatedBaseModel</a>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal registry
storing models by category and discriminator value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DiscriminatedModelRegistry</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registry to store and retrieve discriminated models.</span>

<span class="sd">    This class maintains a registry of discriminated models indexed by their</span>
<span class="sd">    category and discriminator value, allowing lookup of the appropriate model class</span>
<span class="sd">    at validation time.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        _registry (Dict[str, Dict[Any, Type[&quot;DiscriminatedBaseModel&quot;]]]): Internal registry</span>
<span class="sd">            storing models by category and discriminator value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_registry</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;DiscriminatedBaseModel&quot;</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">model_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;DiscriminatedBaseModel&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register a model class for a specific category and discriminator value.</span>

<span class="sd">        Args:</span>
<span class="sd">            category (str): The discriminator category (field name).</span>
<span class="sd">            value (Any): The discriminator value.</span>
<span class="sd">            model_cls : The model class to register.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; DiscriminatedModelRegistry.register(&quot;shape_type&quot;, &quot;circle&quot;, Circle)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_cls</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;DiscriminatedBaseModel&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a model class by category and discriminator value.</span>

<span class="sd">        Args:</span>
<span class="sd">            category: The discriminator category (field name).</span>
<span class="sd">            value: The discriminator value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Type[&quot;DiscriminatedBaseModel&quot;]: The model class registered for this category and value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no model is registered for the given category and value.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; model_cls = DiscriminatedModelRegistry.get_model(&quot;shape_type&quot;, &quot;circle&quot;)</span>
<span class="sd">            &gt;&gt;&gt; instance = model_cls(radius=5)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No models registered for category &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">category</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No model found for value &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; in category &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">value</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_models_for_category</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;DiscriminatedBaseModel&quot;</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all models registered for a specific category.</span>

<span class="sd">        Args:</span>
<span class="sd">            category: The discriminator category (field name).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[Any, Type[&quot;DiscriminatedBaseModel&quot;]]: Dictionary mapping discriminator values</span>
<span class="sd">                to model classes for the specified category.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no models are registered for the given category.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; models = DiscriminatedModelRegistry.get_models_for_category(&quot;shape_type&quot;)</span>
<span class="sd">            &gt;&gt;&gt; for value, model_cls in models.items():</span>
<span class="sd">            ...     print(f&quot;{value}: {model_cls.__name__}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No models registered for category &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatedModelRegistry.get_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_model</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a model class by category and discriminator value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discriminator category (field name).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discriminator value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="DiscriminatedBaseModel (pydantic_discriminated.api.DiscriminatedBaseModel)" href="#pydantic_discriminated.api.DiscriminatedBaseModel">DiscriminatedBaseModel</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type["DiscriminatedBaseModel"]: The model class registered for this category and value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no model is registered for the given category and value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">model_cls</span> <span class="o">=</span> <span class="n">DiscriminatedModelRegistry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;shape_type&quot;</span><span class="p">,</span> <span class="s2">&quot;circle&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span> <span class="o">=</span> <span class="n">model_cls</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;DiscriminatedBaseModel&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a model class by category and discriminator value.</span>

<span class="sd">    Args:</span>
<span class="sd">        category: The discriminator category (field name).</span>
<span class="sd">        value: The discriminator value.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Type[&quot;DiscriminatedBaseModel&quot;]: The model class registered for this category and value.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no model is registered for the given category and value.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; model_cls = DiscriminatedModelRegistry.get_model(&quot;shape_type&quot;, &quot;circle&quot;)</span>
<span class="sd">        &gt;&gt;&gt; instance = model_cls(radius=5)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No models registered for category &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">category</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No model found for value &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; in category &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">value</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatedModelRegistry.get_models_for_category" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_models_for_category</span><span class="p">(</span><span class="n">category</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all models registered for a specific category.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discriminator category (field name).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="typing.Any">Any</span>, <span title="typing.Type">Type</span>[<a class="autorefs autorefs-internal" title="DiscriminatedBaseModel (pydantic_discriminated.api.DiscriminatedBaseModel)" href="#pydantic_discriminated.api.DiscriminatedBaseModel">DiscriminatedBaseModel</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[Any, Type["DiscriminatedBaseModel"]]: Dictionary mapping discriminator values
to model classes for the specified category.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no models are registered for the given category.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">models</span> <span class="o">=</span> <span class="n">DiscriminatedModelRegistry</span><span class="o">.</span><span class="n">get_models_for_category</span><span class="p">(</span><span class="s2">&quot;shape_type&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">model_cls</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">model_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_models_for_category</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;DiscriminatedBaseModel&quot;</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all models registered for a specific category.</span>

<span class="sd">    Args:</span>
<span class="sd">        category: The discriminator category (field name).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[Any, Type[&quot;DiscriminatedBaseModel&quot;]]: Dictionary mapping discriminator values</span>
<span class="sd">            to model classes for the specified category.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If no models are registered for the given category.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; models = DiscriminatedModelRegistry.get_models_for_category(&quot;shape_type&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for value, model_cls in models.items():</span>
<span class="sd">        ...     print(f&quot;{value}: {model_cls.__name__}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No models registered for category &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatedModelRegistry.register" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">model_cls</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Register a model class for a specific category and discriminator value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discriminator category (field name).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discriminator value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_cls</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model class to register.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">DiscriminatedModelRegistry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;shape_type&quot;</span><span class="p">,</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">Circle</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">model_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;DiscriminatedBaseModel&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register a model class for a specific category and discriminator value.</span>

<span class="sd">    Args:</span>
<span class="sd">        category (str): The discriminator category (field name).</span>
<span class="sd">        value (Any): The discriminator value.</span>
<span class="sd">        model_cls : The model class to register.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; DiscriminatedModelRegistry.register(&quot;shape_type&quot;, &quot;circle&quot;, Circle)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_cls</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pydantic_discriminated.api.DiscriminatorAwareBaseModel" class="doc doc-heading">
            <code>DiscriminatorAwareBaseModel</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Base model that handles discriminators in serialization, including nested models.</p>
<p>Use this as a base class for container models when monkey patching is disabled.
This class ensures that discriminator fields are properly included in serialized
output even when the global monkey patching is disabled.</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Container</span><span class="p">(</span><span class="n">DiscriminatorAwareBaseModel</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">shape</span><span class="p">:</span> <span class="n">Circle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">container</span> <span class="o">=</span> <span class="n">Container</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">Circle</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>  <span class="c1"># Will include discriminator fields</span>
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DiscriminatorAwareBaseModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base model that handles discriminators in serialization, including nested models.</span>

<span class="sd">    Use this as a base class for container models when monkey patching is disabled.</span>
<span class="sd">    This class ensures that discriminator fields are properly included in serialized</span>
<span class="sd">    output even when the global monkey patching is disabled.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; class Container(DiscriminatorAwareBaseModel):</span>
<span class="sd">        ...     shape: Circle</span>
<span class="sd">        &gt;&gt;&gt; container = Container(shape=Circle(radius=5))</span>
<span class="sd">        &gt;&gt;&gt; data = container.model_dump()  # Will include discriminator fields</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">model_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override model_dump to include discriminators at all nesting levels.</span>

<span class="sd">        This method ensures that discriminator fields are included in the serialized</span>
<span class="sd">        output regardless of the global monkey patching setting.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the parent model_dump method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): The serialized model with discriminator fields included.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Always use discriminators for this class by setting the flag</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;use_discriminators&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Get standard serialization with discriminators</span>
        <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">_patched</span><span class="p">:</span>
            <span class="c1"># If BaseModel is patched, use the patched method with our flag</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If not patched, use the original method and process it ourselves</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_process_discriminators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">model_dump_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override model_dump_json to include discriminators at all nesting levels.</span>

<span class="sd">        This method ensures that discriminator fields are included in the JSON</span>
<span class="sd">        serialized output regardless of the global monkey patching setting.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the parent model_dump_json method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (str): The JSON string representation of the model with discriminator fields included.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Always use discriminators for this class</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;use_discriminators&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Get data with discriminators (will use our overridden model_dump)</span>
        <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">_patched</span><span class="p">:</span>
            <span class="c1"># If patched, use the patched method with our flag</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If not patched, get data and convert to JSON ourselves</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">encoder</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;encoder&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">encoder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatorAwareBaseModel.model_dump" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Override model_dump to include discriminators at all nesting levels.</p>
<p>This method ensures that discriminator fields are included in the serialized
output regardless of the global monkey patching setting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments to pass to the parent model_dump method.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The serialized model with discriminator fields included.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">model_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Override model_dump to include discriminators at all nesting levels.</span>

<span class="sd">    This method ensures that discriminator fields are included in the serialized</span>
<span class="sd">    output regardless of the global monkey patching setting.</span>

<span class="sd">    Args:</span>
<span class="sd">        **kwargs: Keyword arguments to pass to the parent model_dump method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): The serialized model with discriminator fields included.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Always use discriminators for this class by setting the flag</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;use_discriminators&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Get standard serialization with discriminators</span>
    <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">_patched</span><span class="p">:</span>
        <span class="c1"># If BaseModel is patched, use the patched method with our flag</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If not patched, use the original method and process it ourselves</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_process_discriminators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic_discriminated.api.DiscriminatorAwareBaseModel.model_dump_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model_dump_json</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Override model_dump_json to include discriminators at all nesting levels.</p>
<p>This method ensures that discriminator fields are included in the JSON
serialized output regardless of the global monkey patching setting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments to pass to the parent model_dump_json method.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The JSON string representation of the model with discriminator fields included.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">model_dump_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Override model_dump_json to include discriminators at all nesting levels.</span>

<span class="sd">    This method ensures that discriminator fields are included in the JSON</span>
<span class="sd">    serialized output regardless of the global monkey patching setting.</span>

<span class="sd">    Args:</span>
<span class="sd">        **kwargs: Keyword arguments to pass to the parent model_dump_json method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (str): The JSON string representation of the model with discriminator fields included.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Always use discriminators for this class</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;use_discriminators&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Get data with discriminators (will use our overridden model_dump)</span>
    <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">_patched</span><span class="p">:</span>
        <span class="c1"># If patched, use the patched method with our flag</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If not patched, get data and convert to JSON ourselves</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;encoder&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">encoder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="pydantic_discriminated.api.discriminated_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">discriminated_model</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">discriminator</span><span class="p">,</span> <span class="n">use_standard_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Decorator to create a discriminated model.</p>
<p>This decorator registers a model class with the DiscriminatedModelRegistry
and sets up the discriminator field and value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.Type">Type</span>[<span title="enum.Enum">Enum</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The category field name or Enum class. If an Enum class is provided,
its lowercase name is used as the field name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>discriminator</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discriminator value for this model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_standard_fields</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use standard discriminator fields.
Defaults to the global setting in DiscriminatedConfig.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="typing.Type">Type</span>[<span title="pydantic_discriminated.api.T">T</span>]], <span title="typing.Type">Type</span>[<span title="pydantic_discriminated.api.T">T</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A decorator function that registers the model class.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nd">@discriminated_model</span><span class="p">(</span><span class="s2">&quot;shape_type&quot;</span><span class="p">,</span> <span class="s2">&quot;circle&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">class</span><span class="w"> </span><span class="nc">Circle</span><span class="p">(</span><span class="n">DiscriminatedBaseModel</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">ShapeType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">CIRCLE</span> <span class="o">=</span> <span class="s2">&quot;circle&quot;</span>
<span class="gp">... </span>    <span class="n">RECTANGLE</span> <span class="o">=</span> <span class="s2">&quot;rectangle&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@discriminated_model</span><span class="p">(</span><span class="n">ShapeType</span><span class="p">,</span> <span class="n">ShapeType</span><span class="o">.</span><span class="n">CIRCLE</span><span class="p">)</span>
<span class="gp">... </span><span class="k">class</span><span class="w"> </span><span class="nc">Circle</span><span class="p">(</span><span class="n">DiscriminatedBaseModel</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/pydantic_discriminated/api.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">discriminated_model</span><span class="p">(</span>
    <span class="n">category</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">Enum</span><span class="p">]],</span>
    <span class="n">discriminator</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">use_standard_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator to create a discriminated model.</span>

<span class="sd">    This decorator registers a model class with the DiscriminatedModelRegistry</span>
<span class="sd">    and sets up the discriminator field and value.</span>

<span class="sd">    Args:</span>
<span class="sd">        category: The category field name or Enum class. If an Enum class is provided,</span>
<span class="sd">            its lowercase name is used as the field name.</span>
<span class="sd">        discriminator: The discriminator value for this model.</span>
<span class="sd">        use_standard_fields: Whether to use standard discriminator fields.</span>
<span class="sd">            Defaults to the global setting in DiscriminatedConfig.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A decorator function that registers the model class.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; @discriminated_model(&quot;shape_type&quot;, &quot;circle&quot;)</span>
<span class="sd">        ... class Circle(DiscriminatedBaseModel):</span>
<span class="sd">        ...     radius: float</span>

<span class="sd">        &gt;&gt;&gt; from enum import Enum</span>
<span class="sd">        &gt;&gt;&gt; class ShapeType(str, Enum):</span>
<span class="sd">        ...     CIRCLE = &quot;circle&quot;</span>
<span class="sd">        ...     RECTANGLE = &quot;rectangle&quot;</span>
<span class="sd">        &gt;&gt;&gt; @discriminated_model(ShapeType, ShapeType.CIRCLE)</span>
<span class="sd">        ... class Circle(DiscriminatedBaseModel):</span>
<span class="sd">        ...     radius: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">category_field</span> <span class="o">=</span> <span class="n">category</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
        <span class="n">category_field</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="n">field_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">category_field</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The actual decorator function that transforms the model class.</span>

<span class="sd">        This inner function registers the model class with the DiscriminatedModelRegistry,</span>
<span class="sd">        sets up discriminator attributes, and overrides __init__ to ensure discriminator</span>
<span class="sd">        values are set correctly.</span>

<span class="sd">        Args:</span>
<span class="sd">            cls: The model class to decorate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The decorated model class.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If the class doesn&#39;t inherit from DiscriminatedBaseModel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make sure the class inherits from DiscriminatedBaseModel</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">DiscriminatedBaseModel</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> must inherit from DiscriminatedBaseModel&quot;</span><span class="p">)</span>

        <span class="c1"># Register the model</span>
        <span class="n">DiscriminatedModelRegistry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">discriminator</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># Store the discriminator information as class variables</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_field</span> <span class="o">=</span> <span class="n">field_name</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_discriminator_value</span> <span class="o">=</span> <span class="n">discriminator</span>

        <span class="c1"># Set standard fields configuration</span>
        <span class="k">if</span> <span class="n">use_standard_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_use_standard_fields</span> <span class="o">=</span> <span class="n">use_standard_fields</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;model_config&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;use_standard_fields&quot;</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">model_config</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_use_standard_fields</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">model_config</span><span class="p">[</span><span class="s2">&quot;use_standard_fields&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_use_standard_fields</span> <span class="o">=</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">use_standard_fields</span>

        <span class="c1"># Add the discriminator fields to the model&#39;s annotations</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;__annotations__&quot;</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="vm">__annotations__</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Determine the type of the discriminator field</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">discriminator</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">discriminator</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">discriminator</span><span class="p">)</span>

        <span class="c1"># Add domain-specific field to annotations</span>
        <span class="bp">cls</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_type</span>

        <span class="c1"># Add standard fields to annotations if configured</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_use_standard_fields</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span>
            <span class="bp">cls</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_type</span>

        <span class="c1"># Update model_config to exclude discriminator fields by default</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;model_config&quot;</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">model_config</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Get existing excluded fields or create an empty set</span>
        <span class="n">excluded</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">model_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;excluded&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">excluded</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">excluded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">excluded</span><span class="p">)</span>

        <span class="c1"># Add discriminator fields to excluded</span>
        <span class="n">excluded</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_use_standard_fields</span><span class="p">:</span>
            <span class="n">excluded</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">)</span>
            <span class="n">excluded</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">model_config</span><span class="p">[</span><span class="s2">&quot;excluded&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">excluded</span>

        <span class="c1"># Override __init__ to set the discriminator values</span>
        <span class="n">original_init</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">init_with_discriminator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Overridden __init__ that ensures discriminator values are set correctly.</span>

<span class="sd">            This function adds the discriminator field and value to the initialization</span>
<span class="sd">            data if missing, then calls the original __init__, and finally ensures</span>
<span class="sd">            that discriminator attributes are set on the instance.</span>

<span class="sd">            Args:</span>
<span class="sd">                **data (dict[Any, Any]): Keyword arguments for initialization.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Add domain-specific discriminator field if missing</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">discriminator</span>

            <span class="c1"># Add standard fields if configured</span>
            <span class="n">use_std_fields</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_use_standard_fields</span>
            <span class="k">if</span> <span class="n">use_std_fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_name</span>
                <span class="k">if</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">discriminator</span>

            <span class="n">original_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Ensure discriminator values are set as instance attributes</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">discriminator</span><span class="p">)</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_discriminator_field&quot;</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_discriminator_value&quot;</span><span class="p">,</span> <span class="n">discriminator</span><span class="p">)</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_use_standard_fields&quot;</span><span class="p">,</span> <span class="n">use_std_fields</span><span class="p">)</span>

            <span class="c1"># Set standard fields if configured</span>
            <span class="k">if</span> <span class="n">use_std_fields</span><span class="p">:</span>
                <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_category_field</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
                <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DiscriminatedConfig</span><span class="o">.</span><span class="n">standard_value_field</span><span class="p">,</span> <span class="n">discriminator</span><span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span> <span class="o">=</span> <span class="n">init_with_discriminator</span>

        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.expand", "navigation.indexes", "navigation.top", "search.highlight", "search.share", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>